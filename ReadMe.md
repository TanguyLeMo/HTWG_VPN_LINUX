# HTWG VPN Connect Script (Linux)

This Bash script automates connecting to the **HTWG Konstanz VPN** (OpenVPN with **MFA / OTP**).
It combines your password with a **time-based one-time password (TOTP)** generated by Python — all in a **single command**.

---

## Project Structure

```
vpn-connect/
├── vpn.sh                 -> Main script (executes the VPN connection)
├── getotp.py              -> Python script that generates the OTP from your TOTP secret
└── vpn_log.txt            -> Log file for errors and debug output
```

---

## Requirements

* **OTP secret**
  The OTP secret is provided by the HTWG IT department via QR code.
  For this script, you need the string representation of the secret.
  You can extract it using tools like [extract_otp_secrets](https://github.com/scito/extract_otp_secrets).

* **OpenVPN**

* **Linux system** (e.g. Ubuntu, Fedora, Arch, etc.)

* **Python 3.x** with the `pyotp` package installed:

  ```bash
  pip install pyotp
  ```

* Access to the configuration file **HTWG-MFA-[current_semester]-STUD.ovpn**
  (provided by HTWG → [Link](https://www.htwg-konstanz.de/hochschule/einrichtungen/rechenzentrum/dienste/vpn-verbindung))

---

## Environment Variables

The script uses three environment variables for your credentials and the OTP secret:

```bash
export VPN_USER="your.htwg.username"
export VPN_PASS="your_htwg_account_password"
export HTWG_TOTP_SECRET="SECRET_FROM_MFA_APP"
```

> Tip: You can add these lines to your `.env` or `~/.bashrc` file
> to have them loaded automatically on startup.

---


## Usage

1. **Make the script executable:**

   ```bash
   chmod +x vpn.sh
   ```

2. **Run the script:**

   ```bash
   ./vpn.sh
   ```

   * If not run as root, it will automatically restart with `sudo`.
   * The OTP is generated by `getotp.py`.
   * The OpenVPN connection is established in the same step.

---

## How It Works

1. Checks for root privileges → if not, restarts with `sudo`.
2. Resolves paths relative to the script directory (even when called via symlink).
3. Generates the OTP using the Python script:

   ```bash
   python3 getotp.py $HTWG_TOTP_SECRET
   ```
4. Combines the password and OTP, writes a temporary `auth.txt` file.
5. Starts OpenVPN with:

   ```bash
   openvpn --config HTWG-MFA-SOSE25-STUD.ovpn --auth-user-pass <(echo -e "$VPN_USER\n$VPN_PASS$OTP")
   ```
6. Logs any errors to `vpn_log.txt`.

---

## Debugging

If something goes wrong:

```bash
cat vpn_log.txt
```

Common issues:

* Incorrect `HTWG_TOTP_SECRET`
* Missing `pyotp` installation
* `openvpn` not found in PATH
* Configuration file not found or in wrong directory

---

## Cleanup (optional)

After use, you can safely remove the temporary `auth.txt` file:

```bash
rm -f auth.txt
```

---

## Example

```bash
export VPN_USER="mmuster"
export VPN_PASS="SuperSecure123"
export HTWG_TOTP_SECRET="JBSWY3DPEHPK3PXP"
./vpn.sh
```

---

## Optional: Add to PATH or Create a Symlink

To make the VPN script globally accessible from anywhere, you can add it to your system PATH or create a symbolic link.

### Option 1: Move the script to `/usr/local/bin`

```bash
sudo mv /path/to/vpn-connect/vpn.sh /usr/local/bin/htwg-vpn
sudo chmod +x /usr/local/bin/htwg-vpn
```

Now you can simply run:

```bash
htwg-vpn
```

### Option 2: Create a symlink instead

```bash
sudo ln -s /path/to/vpn-connect/vpn.sh /usr/local/bin/htwg-vpn
```

This way, you can keep your script in its project folder but still run it globally:

```bash
htwg-vpn
```
